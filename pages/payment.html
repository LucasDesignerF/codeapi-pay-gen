<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeAPI - Detalhes do Pagamento</title>
    <!-- Metadados para embeds (inicialmente genéricos, serão atualizados dinamicamente) -->
    <meta name="description" id="meta-description" content="Visualize os detalhes do pagamento Pix gerado pelo CodeAPI Payment Links Gen.">
    <meta property="og:title" id="og-title" content="CodeAPI - Detalhes do Pagamento">
    <meta property="og:description" id="og-description" content="Visualize os detalhes do pagamento Pix gerado pelo CodeAPI Payment Links Gen.">
    <meta property="og:image" id="og-image" content="https://t4.ftcdn.net/jpg/03/48/80/11/360_F_348801155_mjJdt25Vkap8MSgxgMbmOYmdn5JdCfvp.jpg">
    <meta property="og:type" content="website">
    <meta property="og:url" id="og-url" content="https://codeapi-pay.redebots.shop/pages/payment.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitter-title" content="CodeAPI - Detalhes do Pagamento">
    <meta name="twitter:description" id="twitter-description" content="Visualize os detalhes do pagamento Pix gerado pelo CodeAPI Payment Links Gen.">
    <meta name="twitter:image" id="twitter-image" content="https://t4.ftcdn.net/jpg/03/48/80/11/360_F_348801155_mjJdt25Vkap8MSgxgMbmOYmdn5JdCfvp.jpg">
    <meta name="twitter:url" id="twitter-url" content="https://codeapi-pay.redebots.shop/pages/payment.html">
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN via Cloudflare -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- QRCode.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
        body {
            background-image: url('https://t4.ftcdn.net/jpg/03/48/80/11/360_F_348801155_mjJdt25Vkap8MSgxgMbmOYmdn5JdCfvp.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #e0e0e0;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        /* Overlay escuro para melhorar legibilidade */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }
        /* Navbar com blur, fixo no topo */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            backdrop-filter: blur(10px);
            background: rgba(18, 18, 18, 0.8);
            border-bottom: 1px solid rgba(21, 88, 67, 0.3);
            z-index: 10;
        }
        /* Footer com blur, fixo no rodapé */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            backdrop-filter: blur(10px);
            background: rgba(18, 18, 18, 0.8);
            border-top: 1px solid rgba(21, 88, 67, 0.3);
            z-index: 10;
        }
        /* Input e botão com detalhes em verde dólar */
        button {
            background-color: #155843;
        }
        button:hover {
            background-color: #1a6b50;
        }
        /* Conteúdo principal centralizado sem espaçamentos fixos */
        main {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            min-height: calc(100vh - 112px); /* Altura da navbar + footer (56px cada) */
        }
        /* Ajuste responsivo */
        @media (max-width: 640px) {
            .max-w-md {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar p-4 flex justify-between items-center">
        <div class="text-2xl font-bold text-green-400">CodeAPI - Payment Links Gen</div>
        <div class="space-x-4">
            <a href="../index.html" class="text-green-400 hover:text-green-300 transition duration-200">
                <i class="fas fa-home mr-1"></i> Início
            </a>
            <a href="sobre.html" class="text-green-400 hover:text-green-300 transition duration-200">
                <i class="fas fa-info-circle mr-1"></i> Sobre
            </a>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main>
        <div class="max-w-md w-full bg-[#1a1a1a] rounded-lg shadow-lg p-6">
            <h1 class="text-2xl font-bold text-center text-green-400 mb-6">Detalhes do Pagamento</h1>
            <div id="paymentDetails" class="space-y-4">
                <div id="produto" class="text-lg font-semibold"></div>
                <div id="descricao" class="text-sm text-gray-400"></div>
                <div id="valor" class="text-xl font-bold text-green-400"></div>
                <img id="imagem" class="w-full h-48 object-cover rounded mt-2 hidden" alt="Imagem do Produto">
                <div id="qrcode" class="flex justify-center mt-4"></div>
                <div id="payload" class="bg-[#2a2a2a] p-3 rounded mt-4 break-all text-sm"></div>
                <button id="copyPayload" class="w-full text-white py-2 rounded hover:bg-green-700 transition duration-200">
                    <i class="fas fa-copy mr-2"></i> Copiar Payload
                </button>
                <button id="downloadQR" class="w-full bg-[#2a2a2a] text-white py-2 rounded hover:bg-[#333333] transition duration-200 hidden">
                    <i class="fas fa-download mr-2"></i> Baixar QR Code
                </button>
            </div>
            <div id="error" class="text-center text-red-500 hidden">Erro ao carregar os dados.</div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer p-4 flex justify-center items-center">
        <p class="text-sm">
            © Code API é Propriedade <a href="https://discord.gg/x74fnzcz2S" class="text-green-400 hover:text-green-300 transition duration-200">CodeProjects</a>, by LucasDev. Todos os direitos reservados.
        </p>
    </footer>

    <script src="../scr/jsonbin.js"></script>
    <script src="../scr/payload.js"></script>
    <script>
        $(document).ready(async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const recordId = urlParams.get('id');

            if (!recordId) {
                $('#error').removeClass('hidden');
                $('#paymentDetails').addClass('hidden');
                return;
            }

            try {
                const data = await getFromJsonBin(recordId);
                if (data) {
                    $('#produto').text(data.produto);
                    $('#descricao').text(data.descricao);
                    $('#valor').text(`R$ ${data.valor.toFixed(2)}`);
                    $('#payload').text(data.payload);

                    if (data.imagem) {
                        $('#imagem').attr('src', data.imagem).removeClass('hidden');
                    }

                    // Atualizar metadados dinamicamente
                    const currentUrl = window.location.href;
                    const dynamicTitle = `Pagamento: ${data.produto} - CodeAPI`;
                    const dynamicDescription = `${data.descricao} | Valor: R$ ${data.valor.toFixed(2)} | Gere seu pagamento Pix com CodeAPI.`;
                    const dynamicImage = data.imagem || 'https://t4.ftcdn.net/jpg/03/48/80/11/360_F_348801155_mjJdt25Vkap8MSgxgMbmOYmdn5JdCfvp.jpg';

                    // Atualizar title
                    document.title = dynamicTitle;

                    // Atualizar metadados Open Graph
                    $('#og-title').attr('content', dynamicTitle);
                    $('#og-description').attr('content', dynamicDescription);
                    $('#og-image').attr('content', dynamicImage);
                    $('#og-url').attr('content', currentUrl);

                    // Atualizar metadados Twitter
                    $('#twitter-title').attr('content', dynamicTitle);
                    $('#twitter-description').attr('content', dynamicDescription);
                    $('#twitter-image').attr('content', dynamicImage);
                    $('#twitter-url').attr('content', currentUrl);

                    // Atualizar meta description
                    $('#meta-description').attr('content', dynamicDescription);

                    // Geração do QR Code com configurações específicas
                    const qrCodeConfig = {
                        width: 300,
                        height: 300,
                        margin: 4, // Equivalente ao border=4
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.M // Equivalente a ERROR_CORRECT_M
                    };

                    QRCode.toCanvas(document.getElementById('qrcode'), data.payload, qrCodeConfig, function(error) {
                        if (error) {
                            console.error('Erro ao gerar QR Code:', error);
                        } else {
                            $('#downloadQR').removeClass('hidden');
                        }
                    });

                    // Copiar Payload
                    $('#copyPayload').on('click', function() {
                        navigator.clipboard.writeText(data.payload).then(() => {
                            alert('Payload copiado com sucesso!');
                        });
                    });

                    // Baixar QR Code como imagem
                    $('#downloadQR').on('click', function() {
                        const canvas = document.getElementById('qrcode').querySelector('canvas');
                        const link = document.createElement('a');
                        link.download = `pix-qrcode-${data.descricao}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    });
                } else {
                    $('#error').removeClass('hidden');
                    $('#paymentDetails').addClass('hidden');
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                $('#error').removeClass('hidden');
                $('#paymentDetails').addClass('hidden');
            }
        });
    </script>
</body>
</html>